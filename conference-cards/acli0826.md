# UX3 ä¸‰åˆ€æµäº¤æµç ”è¨æœƒ - é–‹ç™¼é€²åº¦å ±å‘Š

**æ—¥æœŸï¼š** 2025-01-26  
**å°ˆæ¡ˆï¼š** Conference Cards Interactive Platform  
**é–‹ç™¼è€…ï¼š** acli + RovoDev AI Assistant

---

## ğŸ“‹ ç›®å‰å·²å®Œæˆçš„åŠŸèƒ½

### 1. åŸºç¤æ¶æ§‹ âœ…
- **Next.js 14** æ‡‰ç”¨ç¨‹å¼æ¡†æ¶
- **TypeScript** é¡å‹å®‰å…¨
- **Tailwind CSS** æ¨£å¼ç³»çµ±
- **Framer Motion** å‹•ç•«æ•ˆæœ
- **éŸ¿æ‡‰å¼è¨­è¨ˆ** æ”¯æ´æ‰‹æ©Ÿã€å¹³æ¿ã€æ¡Œé¢

### 2. ç”¨æˆ¶ä»‹é¢ âœ…
- **é¦–é è¨­è¨ˆ** - å‹•æ…‹æ¨™é¡Œã€åŠŸèƒ½ç‰¹è‰²å±•ç¤º
- **å¡ç‰‡ç¶²æ ¼ç³»çµ±** - éŸ¿æ‡‰å¼å¡ç‰‡ä½ˆå±€
- **äº’å‹•å¼å¡ç‰‡** - 3Dç¿»è½‰æ•ˆæœã€æ‡¸åœå…‰æ•ˆ
- **æŠ½å¡é é¢** - éš¨æ©ŸæŠ½å¡åŠŸèƒ½ã€æŠ½å¡è¨˜éŒ„
- **ä¸Šå‚³é é¢** - æ‹–æ‹½ä¸Šå‚³ã€åœ–ç‰‡é è¦½

### 3. Firebase æ•´åˆ âœ…
- **Firebase å°ˆæ¡ˆè¨­å®š** - å®Œæ•´é…ç½®
- **Google Authentication** - ä¸€éµç™»å…¥ç³»çµ±
- **Cloud Firestore** - è³‡æ–™åº«è¨­å®š
- **ç”¨æˆ¶ç‹€æ…‹ç®¡ç†** - AuthContext å¯¦ä½œ

### 4. è³‡æ–™ç®¡ç† âœ…
- **å¡ç‰‡ä¸Šå‚³åŠŸèƒ½** - æ”¯æ´æ­£é¢/èƒŒé¢åœ–ç‰‡
- **Firestore è³‡æ–™å„²å­˜** - ç”¨æˆ¶è³‡æ–™ + å¡ç‰‡è³‡æ–™
- **æœ¬åœ°å­˜å„²å‚™ä»½** - é›™é‡å„²å­˜æ©Ÿåˆ¶
- **è³‡æ–™è®€å–æ•´åˆ** - Firestore + æœ¬åœ°å­˜å„²åˆä½µ

### 5. ç”¨æˆ¶é«”é©— âœ…
- **ç™»å…¥ä¿è­·æ©Ÿåˆ¶** - æœªç™»å…¥ç”¨æˆ¶å°å‘
- **ç”¨æˆ¶é¸å–®ç³»çµ±** - é ­åƒé¡¯ç¤ºã€ç™»å‡ºåŠŸèƒ½
- **éŒ¯èª¤è™•ç†** - å‹å–„çš„éŒ¯èª¤æç¤º
- **è¼‰å…¥ç‹€æ…‹** - è¼‰å…¥å‹•ç•«æ•ˆæœ

---

## ğŸ”§ æœ€è¿‘ä¿®å¾©çš„å•é¡Œ

### æŠ€è¡“å•é¡Œä¿®å¾©
1. **Firebase SDK å®‰è£** - è§£æ±ºæ¨¡çµ„æ‰¾ä¸åˆ°å•é¡Œ
2. **ç”¨æˆ¶é¸å–®å®šä½** - ä¿®å¾©è¢å¹•åˆ‡æ–·å•é¡Œ
3. **é‡è¤‡è®Šæ•¸å®šç¾©** - ä¿®å¾© router é‡è¤‡å®£å‘Š
4. **è®Šæ•¸ä½œç”¨åŸŸ** - ä¿®å¾© userId ä½œç”¨åŸŸå•é¡Œ
5. **Firestore å®‰å…¨è¦å‰‡** - è¨­å®šæ­£ç¢ºçš„è®€å¯«æ¬Šé™

---

## ğŸš€ æ¥ä¸‹ä¾†è¦åšçš„åŠŸèƒ½

### 1. é«˜å„ªå…ˆç´š (ä¸‹æ¬¡é–‹ç™¼é‡é»)
- [x] **æ¸¬è©¦ä¸Šå‚³åŠŸèƒ½** - âœ… å·²ç¢ºèªå¯ä»¥æˆåŠŸä¸Šå‚³åˆ° Firestore
- [ ] **ä¿®å¾©é‡è¤‡å¡ç‰‡å•é¡Œ** - è§£æ±º Firestore + æœ¬åœ°å­˜å„²é‡è¤‡é¡¯ç¤ºå•é¡Œ
- [ ] **API è·¯ç”±ä¿è­·** - ä¸Šå‚³ API åŠ å…¥ JWT token é©—è­‰
- [ ] **ç”¨æˆ¶å¡ç‰‡ç®¡ç†** - è®“ç”¨æˆ¶å¯ä»¥æŸ¥çœ‹/ç·¨è¼¯/åˆªé™¤è‡ªå·±çš„å¡ç‰‡
- [ ] **åœ–ç‰‡å„²å­˜å„ªåŒ–** - ä½¿ç”¨ Firebase Storage å„²å­˜åœ–ç‰‡

### 2. ä¸­å„ªå…ˆç´š (å„ªåŒ–èˆ‡é«”é©—)
- [ ] **åœ–ç‰‡å£“ç¸®å„ªåŒ–** - æ¸›å°‘ä¸Šå‚³æª”æ¡ˆå¤§å°å’Œè®€å–æ™‚é–“
- [ ] **localStorage ç·©å­˜** - ç·©å­˜å·²æŠ½å¡ç‰‡IDï¼Œæ¸›å°‘é‡è¤‡æŸ¥è©¢
- [ ] **åœ–ç‰‡ CDN æ•´åˆ** - ä½¿ç”¨ Cloudflare ç­‰ CDN åŠ é€Ÿåœ–ç‰‡è¼‰å…¥
- [ ] **è¡Œå‹•è£ç½®å„ªåŒ–** - å¤§æ‹‡æŒ‡å€åŸŸæŒ‰éˆ•ä½ˆå±€ + è§¸æ§éœ‡å‹•å›é¥‹
- [ ] **Service Worker** - é›¢ç·šç·©å­˜å’ŒèƒŒæ™¯åŒæ­¥
- [ ] **åˆ†é è¼‰å…¥** - é¿å…ä¸€æ¬¡è¼‰å…¥æ‰€æœ‰å¡ç‰‡
- [ ] **å¡ç‰‡æ¨¡æ¿ä¸‹è¼‰** - å¯¦ä½œ Figma æ¨¡æ¿ä¸‹è¼‰åŠŸèƒ½

### 3. ä½å„ªå…ˆç´š
- [ ] **å¡ç‰‡åˆ†é¡ç³»çµ±** - æŒ‰éƒ¨é–€ã€æŠ€èƒ½åˆ†é¡
- [ ] **ç¤¾äº¤åŠŸèƒ½** - å¡ç‰‡é»è®šã€æ”¶è—
- [ ] **çµ±è¨ˆåˆ†æ** - æŠ½å¡çµ±è¨ˆã€ç†±é–€å¡ç‰‡
- [ ] **å¤šèªè¨€æ”¯æ´** - è‹±æ–‡ç‰ˆæœ¬

---

## ğŸ”„ ä¸‹æ¬¡é–‹ç™¼å•Ÿå‹•æŒ‡å—

### 1. ç’°å¢ƒæº–å‚™
```bash
# 1. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev
# æˆ–
pnpm dev

# 2. é–‹å•Ÿç€è¦½å™¨
http://localhost:3000
```

### 2. ç•¶å‰ç‹€æ…‹æª¢æŸ¥
- [ ] ç¢ºèª Google ç™»å…¥åŠŸèƒ½æ­£å¸¸
- [ ] æ¸¬è©¦å¡ç‰‡ä¸Šå‚³åˆ° Firestore
- [ ] æª¢æŸ¥é¦–é æ˜¯å¦é¡¯ç¤º Firestore å¡ç‰‡
- [ ] é©—è­‰æŠ½å¡åŠŸèƒ½æ˜¯å¦åŒ…å«æ–°ä¸Šå‚³çš„å¡ç‰‡

### 3. å·²çŸ¥å•é¡Œå¾…è§£æ±º
- **âœ… ä¸Šå‚³åŠŸèƒ½** - å·²ä¿®å¾©ï¼Œå¯ä»¥æˆåŠŸä¸Šå‚³åˆ° Firestore
- **âš ï¸ é‡è¤‡å¡ç‰‡é¡¯ç¤º** - ä¸Šå‚³å¾Œæœƒé¡¯ç¤º2å¼µç›¸åŒå¡ç‰‡ï¼ˆ1å¼µä¾†è‡ªFirestoreï¼Œ1å¼µä¾†è‡ªæœ¬åœ°å­˜å„²ï¼‰
- **åœ–ç‰‡å„²å­˜** - ç›®å‰ä½¿ç”¨ base64ï¼Œéœ€è¦æ”¹ç‚º Firebase Storage
- **éŒ¯èª¤è™•ç†** - éœ€è¦æ›´è©³ç´°çš„éŒ¯èª¤è¨Šæ¯é¡¯ç¤º

### 4. é–‹ç™¼é‡é»æé†’
1. **å…ˆç¢ºä¿åŸºæœ¬åŠŸèƒ½ç©©å®š** - ä¸Šå‚³ã€é¡¯ç¤ºã€æŠ½å¡
2. **é€æ­¥æ·»åŠ æ–°åŠŸèƒ½** - é¿å…ä¸€æ¬¡æ€§å¤§æ”¹å‹•
3. **ä¿æŒæ¸¬è©¦ç¿’æ…£** - æ¯æ¬¡ä¿®æ”¹å¾Œç«‹å³æ¸¬è©¦
4. **æ³¨æ„ç”¨æˆ¶é«”é©—** - è¼‰å…¥ç‹€æ…‹ã€éŒ¯èª¤æç¤ºã€éŸ¿æ‡‰å¼è¨­è¨ˆ

---

## ğŸ“ é‡è¦æª”æ¡ˆçµæ§‹

```
conference-cards/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ page.tsx              # é¦–é 
â”‚   â”œâ”€â”€ upload/page.tsx       # ä¸Šå‚³é é¢
â”‚   â”œâ”€â”€ draw/page.tsx         # æŠ½å¡é é¢
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ cards/route.ts    # å¡ç‰‡ API
â”‚       â””â”€â”€ upload/route.ts   # ä¸Šå‚³ API
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ user-menu.tsx         # ç”¨æˆ¶é¸å–®
â”‚   â”œâ”€â”€ google-login-modal.tsx # ç™»å…¥å½ˆçª—
â”‚   â”œâ”€â”€ card-grid.tsx         # å¡ç‰‡ç¶²æ ¼
â”‚   â””â”€â”€ interactive-card.tsx  # äº’å‹•å¡ç‰‡
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx       # èªè­‰ä¸Šä¸‹æ–‡
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ firebase.ts           # Firebase é…ç½®
â”‚   â””â”€â”€ firestore.ts          # Firestore æœå‹™
â””â”€â”€ public/
    â””â”€â”€ carddata.json         # å‡è³‡æ–™ (æ¸¬è©¦ç”¨)
```

---

## ğŸ”§ é‡é»æ”¹é€²é …ç›®è©³ç´°èªªæ˜

### 1. API è·¯ç”±ä¿è­·
```typescript
// middleware.ts - JWT é©—è­‰ä¸­é–“ä»¶
import { NextRequest } from 'next/server'
import { verifyIdToken } from '@/lib/firebase-admin'

export async function middleware(request: NextRequest) {
  if (request.nextUrl.pathname.startsWith('/api/upload')) {
    const token = request.headers.get('authorization')?.replace('Bearer ', '')
    
    if (!token) {
      return new Response('Unauthorized', { status: 401 })
    }
    
    try {
      await verifyIdToken(token)
    } catch (error) {
      return new Response('Invalid token', { status: 401 })
    }
  }
}
```

### 2. åœ–ç‰‡ CDN æ•´åˆ
```typescript
// åœ–ç‰‡ URL è™•ç†
const getOptimizedImageUrl = (originalUrl: string, width?: number) => {
  // Cloudflare Images æˆ–å…¶ä»– CDN
  const baseUrl = 'https://imagedelivery.net/your-account-id'
  return `${baseUrl}/${originalUrl}/w=${width || 800},q=80`
}
```

### 3. Service Worker é›¢ç·šæ”¯æ´
```javascript
// public/sw.js
self.addEventListener('fetch', (event) => {
  if (event.request.url.includes('/api/cards')) {
    event.respondWith(
      caches.match(event.request)
        .then(response => response || fetch(event.request))
    )
  }
})
```

### 4. è¡Œå‹•è£ç½®è§¸æ§å„ªåŒ–
```typescript
// å¤§æ‹‡æŒ‡å€åŸŸè¨­è¨ˆ (åº•éƒ¨ 120px å€åŸŸ)
const MobileLayout = () => (
  <div className="pb-safe-bottom">
    {/* ä¸»è¦å…§å®¹ */}
    <main className="pb-32">...</main>
    
    {/* å¤§æ‹‡æŒ‡å€åŸŸ - é‡è¦æŒ‰éˆ• */}
    <div className="fixed bottom-0 left-0 right-0 h-32 bg-black/90 backdrop-blur">
      <div className="flex justify-center items-center h-full px-6">
        <Button 
          className="w-full max-w-sm h-14 text-lg"
          onClick={handlePrimaryAction}
          onTouchStart={() => navigator.vibrate?.(50)} // è§¸æ§éœ‡å‹•
        >
          ä¸»è¦æ“ä½œ
        </Button>
      </div>
    </div>
  </div>
)
```

### 5. è§¸æ§éœ‡å‹•å›é¥‹
```typescript
// è§¸æ§å›é¥‹å·¥å…·å‡½æ•¸
export const hapticFeedback = {
  light: () => navigator.vibrate?.(10),
  medium: () => navigator.vibrate?.(50),
  heavy: () => navigator.vibrate?.(100),
  success: () => navigator.vibrate?.[50, 50, 50],
  error: () => navigator.vibrate?.[100, 50, 100]
}

// ä½¿ç”¨ç¯„ä¾‹
<Button 
  onTouchStart={() => hapticFeedback.light()}
  onClick={() => {
    // æ“ä½œæˆåŠŸ
    hapticFeedback.success()
  }}
>
  æŒ‰éˆ•
</Button>
```

---

## ğŸ’° Firebase è²»ç”¨å„ªåŒ–ç­–ç•¥

### 1. åœ–ç‰‡å„ªåŒ–æ–¹æ¡ˆ

#### **å£“ç¸®ç­–ç•¥**
```javascript
// å‰ç«¯åœ–ç‰‡å£“ç¸® (å»ºè­°å¯¦ä½œ)
const compressImage = (file, maxWidth = 800, quality = 0.8) => {
  return new Promise((resolve) => {
    const canvas = document.createElement('canvas')
    const ctx = canvas.getContext('2d')
    const img = new Image()
    
    img.onload = () => {
      // è¨ˆç®—æ–°å°ºå¯¸ (ä¿æŒæ¯”ä¾‹)
      const ratio = Math.min(maxWidth / img.width, maxWidth / img.height)
      canvas.width = img.width * ratio
      canvas.height = img.height * ratio
      
      // ç¹ªè£½ä¸¦å£“ç¸®
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height)
      canvas.toBlob(resolve, 'image/jpeg', quality)
    }
    
    img.src = URL.createObjectURL(file)
  })
}
```

#### **æª”æ¡ˆå¤§å°é™åˆ¶**
- **ç›®æ¨™å¤§å°**: æ¯å¼µåœ–ç‰‡ < 200KB
- **è§£æåº¦**: æœ€å¤§ 800x800px
- **æ ¼å¼**: JPEG (å£“ç¸®ç‡æ›´å¥½)
- **å“è³ª**: 80% (å¹³è¡¡å“è³ªèˆ‡å¤§å°)

#### **è¼‰å…¥å„ªåŒ–**
- **æ‡¶åŠ è¼‰**: åªè¼‰å…¥å¯è¦‹çš„å¡ç‰‡åœ–ç‰‡
- **ç¸®åœ–ç³»çµ±**: åˆ—è¡¨é¡¯ç¤ºç”¨å°åœ–ï¼Œé»æ“Šæ‰è¼‰å…¥å¤§åœ–
- **WebP æ ¼å¼**: ç¾ä»£ç€è¦½å™¨æ”¯æ´ï¼Œæª”æ¡ˆæ›´å°

### 2. localStorage ç·©å­˜ç­–ç•¥

#### **ç·©å­˜çµæ§‹è¨­è¨ˆ**
```javascript
// localStorage è³‡æ–™çµæ§‹
const cacheStructure = {
  cards: {
    data: [], // å¡ç‰‡è³‡æ–™
    lastUpdate: timestamp, // æœ€å¾Œæ›´æ–°æ™‚é–“
    version: "1.0" // ç‰ˆæœ¬æ§åˆ¶
  },
  drawnCards: {
    ids: [], // å·²æŠ½å¡ç‰‡IDåˆ—è¡¨
    history: [], // æŠ½å¡æ­·å² (æœ€è¿‘20æ¬¡)
    lastDraw: timestamp
  },
  userPreferences: {
    theme: "dark",
    language: "zh-TW"
  }
}
```

#### **ç·©å­˜ç­–ç•¥**
1. **é¦–æ¬¡è¼‰å…¥**: å¾ Firestore ç²å– â†’ å­˜å…¥ localStorage
2. **å¾ŒçºŒè¼‰å…¥**: å…ˆè®€ localStorage â†’ èƒŒæ™¯æ›´æ–° Firestore
3. **è³‡æ–™åŒæ­¥**: æ¯5åˆ†é˜æª¢æŸ¥ä¸€æ¬¡æ›´æ–°
4. **å®¹é‡ç®¡ç†**: é™åˆ¶ç·©å­˜å¤§å°ï¼Œè‡ªå‹•æ¸…ç†èˆŠè³‡æ–™

#### **å¯¦ä½œå„ªå…ˆç´š**
```javascript
// 1. å¡ç‰‡åˆ—è¡¨ç·©å­˜ (é«˜å„ªå…ˆç´š)
const getCachedCards = () => {
  const cached = localStorage.getItem('cards')
  if (cached && !isExpired(cached.lastUpdate)) {
    return cached.data // ç›´æ¥ä½¿ç”¨ç·©å­˜
  }
  return fetchFromFirestore() // ç·©å­˜éæœŸæ‰æŸ¥è©¢
}

// 2. æŠ½å¡æ­·å²ç·©å­˜ (ä¸­å„ªå…ˆç´š)
const cacheDrawnCard = (cardId) => {
  const drawn = JSON.parse(localStorage.getItem('drawnCards') || '[]')
  drawn.unshift(cardId)
  localStorage.setItem('drawnCards', JSON.stringify(drawn.slice(0, 20)))
}
```

### 3. Firestore è®€å–å„ªåŒ–

#### **æŸ¥è©¢å„ªåŒ–**
- **åˆ†é è¼‰å…¥**: æ¯æ¬¡åªè¼‰å…¥ 20 å¼µå¡ç‰‡
- **ç´¢å¼•å„ªåŒ–**: ç‚ºå¸¸ç”¨æŸ¥è©¢å»ºç«‹ç´¢å¼•
- **æ¢ä»¶æŸ¥è©¢**: é¿å…å…¨è¡¨æƒæ

#### **å¯«å…¥å„ªåŒ–**
- **æ‰¹æ¬¡å¯«å…¥**: å¤šå€‹æ“ä½œåˆä½µç‚ºä¸€æ¬¡
- **é›¢ç·šæ”¯æ´**: ç¶²è·¯ä¸ç©©æ™‚æš«å­˜æœ¬åœ°

### 4. è²»ç”¨ä¼°ç®—

#### **ç›®å‰ä½¿ç”¨é‡ (é ä¼°)**
- **è®€å–**: æ¯ç”¨æˆ¶æ¯å¤© ~50 æ¬¡
- **å¯«å…¥**: æ¯ç”¨æˆ¶æ¯å¤© ~5 æ¬¡
- **å„²å­˜**: æ¯å¼µå¡ç‰‡ ~1KB (ä¸å«åœ–ç‰‡)

#### **å„ªåŒ–å¾Œé æœŸ**
- **è®€å–æ¸›å°‘**: 70% (ç·©å­˜å‘½ä¸­)
- **æª”æ¡ˆå¤§å°**: æ¸›å°‘ 60% (åœ–ç‰‡å£“ç¸®)
- **ç¸½è²»ç”¨**: é ä¼°æ¸›å°‘ 50-70%

---

## ğŸ’¡ RovoDev ç¹¼çºŒé–‹ç™¼æŒ‡ä»¤

**ä¸‹æ¬¡å•Ÿå‹•æ™‚ï¼Œè«‹å‘Šè¨´ RovoDevï¼š**

> "è«‹ç¹¼çºŒé–‹ç™¼ UX3 ç ”è¨æœƒåç‰‡å¹³å°ã€‚ç›®å‰å·²å®Œæˆ Firebase æ•´åˆå’ŒåŸºæœ¬åŠŸèƒ½ï¼Œéœ€è¦ï¼š
> 1. æ¸¬è©¦ä¸¦ä¿®å¾©å¡ç‰‡ä¸Šå‚³åˆ° Firestore çš„åŠŸèƒ½
> 2. å¯¦ä½œç”¨æˆ¶å¡ç‰‡ç®¡ç†åŠŸèƒ½
> 3. å„ªåŒ–åœ–ç‰‡å„²å­˜æ–¹æ¡ˆ
> 
> è«‹å…ˆæª¢æŸ¥ acli0826.md å ±å‘Šäº†è§£ç›®å‰é€²åº¦ã€‚"

---

**å°ˆæ¡ˆç‹€æ…‹ï¼š** ğŸŸ¡ é–‹ç™¼ä¸­ (æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆ 80%)  
**ä¸‹æ¬¡é‡é»ï¼š** ğŸ¯ ç¢ºä¿ Firestore ä¸Šå‚³åŠŸèƒ½æ­£å¸¸é‹ä½œ